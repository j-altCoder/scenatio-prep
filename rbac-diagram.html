<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RBAC â€” Role-Based Access Control</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=DM+Mono:ital,wght@0,300;0,400;0,500;1,300&family=Unbounded:wght@400;600;700;900&display=swap');
:root{--bg:#06080d;--s1:#0b0f18;--s2:#111827;--bd:#1f2937;--bd2:#374151;--tx:#f1f5f9;--mu:#6b7280;--so:#9ca3af;--sa:#f43f5e;--ad:#f97316;--mg:#eab308;--ed:#22c55e;--vw:#06b6d4;--gs:#8b5cf6;--cr:#34d399;--rd:#60a5fa;--up:#fbbf24;--dl:#f87171;}
*{box-sizing:border-box;margin:0;padding:0;}
body{background:var(--bg);color:var(--tx);font-family:'DM Mono',monospace;min-height:100vh;}
body::before{content:'';position:fixed;inset:0;background:repeating-linear-gradient(-55deg,transparent,transparent 60px,rgba(255,255,255,.012) 60px,rgba(255,255,255,.012) 61px);pointer-events:none;z-index:0;}
.wrap{position:relative;z-index:1;max-width:1360px;margin:0 auto;padding:48px 24px 100px;}
.header{margin-bottom:52px;animation:riseUp .6s cubic-bezier(.16,1,.3,1) both;}
.eyebrow{display:flex;align-items:center;gap:8px;margin-bottom:20px;flex-wrap:wrap;}
.badge{font-size:10px;letter-spacing:3px;text-transform:uppercase;padding:4px 12px;border-radius:3px;border:1px solid;}
.badge-r{color:var(--sa);border-color:rgba(244,63,94,.3);background:rgba(244,63,94,.08);}
.badge-m{color:var(--mu);border-color:var(--bd);background:transparent;}
.header h1{font-family:'Unbounded',sans-serif;font-size:clamp(30px,5vw,58px);font-weight:900;letter-spacing:-2px;line-height:1;}
.header h1 em{font-style:normal;color:transparent;-webkit-text-stroke:1px rgba(244,63,94,.6);}
.header p{margin-top:14px;font-size:13px;color:var(--mu);font-weight:300;letter-spacing:.5px;line-height:1.7;max-width:580px;}
.tabs{display:flex;gap:1px;margin-bottom:38px;background:var(--bd);border-radius:8px;padding:1px;width:fit-content;max-width:100%;overflow-x:auto;animation:riseUp .6s .08s cubic-bezier(.16,1,.3,1) both;}
.tab{padding:10px 18px;border-radius:7px;font-family:'DM Mono',monospace;font-size:11.5px;cursor:pointer;border:none;background:var(--s1);color:var(--mu);transition:all .18s;white-space:nowrap;letter-spacing:.5px;}
.tab.active{background:var(--s2);color:var(--tx);border:1px solid var(--bd2);}
.tab:hover:not(.active){color:var(--so);background:var(--s2);}
.panel{display:none;}.panel.active{display:block;animation:fadeIn .3s ease both;}
.sl{font-size:10px;letter-spacing:3px;text-transform:uppercase;color:var(--mu);margin-bottom:16px;display:flex;align-items:center;gap:12px;}
.sl::after{content:'';flex:1;height:1px;background:var(--bd);}
.g2{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:16px;}
.g3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:14px;margin-bottom:16px;}
@media(max-width:900px){.g2,.g3{grid-template-columns:1fr 1fr;}}
@media(max-width:600px){.g2,.g3{grid-template-columns:1fr;}}
.card{background:var(--s1);border:1px solid var(--bd);border-radius:10px;padding:18px 20px;transition:border-color .2s;}
.card:hover{border-color:var(--bd2);}
.ct{font-family:'Unbounded',sans-serif;font-size:11px;font-weight:600;letter-spacing:1px;text-transform:uppercase;margin-bottom:14px;display:flex;align-items:center;gap:10px;}
.cd{width:10px;height:10px;border-radius:50%;flex-shrink:0;}
.ir{display:flex;justify-content:space-between;align-items:flex-start;padding:7px 0;border-bottom:1px solid var(--bd);gap:12px;}
.ir:last-child{border-bottom:none;}
.ik{font-size:11px;color:var(--mu);flex-shrink:0;}
.iv{font-size:11px;color:var(--tx);text-align:right;line-height:1.5;}
.pill{display:inline-block;padding:2px 9px;border-radius:3px;font-size:10px;font-weight:500;letter-spacing:.5px;border:1px solid;}
.pg{color:#4ade80;border-color:rgba(74,222,128,.3);background:rgba(74,222,128,.08);}
.pr{color:#f87171;border-color:rgba(248,113,113,.3);background:rgba(248,113,113,.08);}
.pa{color:#fbbf24;border-color:rgba(251,191,36,.3);background:rgba(251,191,36,.08);}
.pb{color:#60a5fa;border-color:rgba(96,165,250,.3);background:rgba(96,165,250,.08);}
.pp{color:#a78bfa;border-color:rgba(167,139,250,.3);background:rgba(167,139,250,.08);}
.note{padding:12px 16px;border-radius:8px;font-size:11.5px;line-height:1.7;border-left:3px solid;margin-bottom:16px;font-weight:300;}
.ni{background:rgba(96,165,250,.07);border-color:#3b82f6;color:#93c5fd;}
.nw{background:rgba(251,191,36,.07);border-color:#d97706;color:#fcd34d;}
.no{background:rgba(74,222,128,.07);border-color:#16a34a;color:#86efac;}
.ne{background:rgba(248,113,113,.07);border-color:#dc2626;color:#fca5a5;}
.cb{background:var(--s2);border:1px solid var(--bd);border-radius:10px;padding:18px 20px;margin-bottom:16px;overflow-x:auto;}
.ch{font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--mu);margin-bottom:12px;display:flex;align-items:center;gap:8px;}
pre{font-family:'DM Mono',monospace;font-size:12px;line-height:1.85;color:var(--mu);white-space:pre-wrap;word-break:break-word;}
pre .kw{color:#c084fc;}pre .str{color:#86efac;}pre .fn{color:#67e8f9;}pre .cm{color:#374151;font-style:italic;}pre .num{color:#fcd34d;}pre .obj{color:#fb923c;}pre .key{color:#93c5fd;}
.mwrap{background:var(--s1);border:1px solid var(--bd);border-radius:10px;overflow:auto;margin-bottom:16px;}
.mx{width:100%;border-collapse:collapse;font-size:11px;min-width:700px;}
.mx th{padding:12px 14px;text-align:center;font-size:10px;letter-spacing:1.5px;text-transform:uppercase;font-weight:600;border-bottom:1px solid var(--bd2);white-space:nowrap;}
.mx th:first-child{text-align:left;min-width:200px;}
.mx td{padding:11px 14px;border-bottom:1px solid var(--bd);text-align:center;font-size:12px;}
.mx td:first-child{text-align:left;color:var(--so);font-size:11px;letter-spacing:.5px;}
.mx tr:last-child td{border-bottom:none;}.mx tr:hover td{background:var(--s2);}
.mx .rg{background:var(--s2);font-family:'Unbounded',sans-serif;font-size:10px;font-weight:600;letter-spacing:2px;text-transform:uppercase;color:var(--mu);padding:8px 14px;border-bottom:1px solid var(--bd);}
.ac{color:#34d399;font-size:16px;}.dc{color:var(--bd2);font-size:14px;opacity:.5;}.oc{color:#fbbf24;font-size:13px;}
.tl{position:relative;padding-left:30px;margin-bottom:16px;}
.tl::before{content:'';position:absolute;left:8px;top:6px;bottom:6px;width:2px;border-radius:2px;background:linear-gradient(to bottom,var(--sa),var(--ad),var(--mg),var(--ed));}
.tli{position:relative;margin-bottom:20px;}
.tli::before{content:'';position:absolute;left:-24px;top:5px;width:10px;height:10px;border-radius:50%;background:var(--bg);border:2px solid var(--bd2);}
.tli.so::before{border-color:#34d399;}.tli.se::before{border-color:var(--sa);}.tli.sw::before{border-color:#fbbf24;}.tli.si::before{border-color:#60a5fa;}
.tlt{font-family:'Unbounded',sans-serif;font-size:12px;font-weight:600;color:var(--tx);margin-bottom:5px;display:flex;align-items:center;flex-wrap:wrap;gap:8px;letter-spacing:.3px;}
.tld{font-size:11.5px;color:var(--mu);line-height:1.7;font-weight:300;}
.hier{display:flex;flex-direction:column;align-items:center;gap:0;padding:20px 0;margin-bottom:16px;}
.hrow{display:flex;justify-content:center;gap:14px;width:100%;}
.hrole{padding:12px 20px;border-radius:8px;border:1px solid;text-align:center;min-width:130px;cursor:default;transition:transform .15s;}
.hrole:hover{transform:translateY(-2px);}
.hrname{font-family:'Unbounded',sans-serif;font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-bottom:4px;}
.hrdesc{font-size:10px;color:var(--mu);letter-spacing:.3px;}
.hconn{width:2px;height:20px;background:var(--bd2);margin:0 auto;}
.pflow{display:flex;align-items:stretch;gap:0;margin-bottom:16px;overflow-x:auto;}
.pfs{display:flex;flex-direction:column;align-items:center;min-width:130px;flex:1;}
.pfb{background:var(--s1);border:1px solid var(--bd);border-radius:8px;padding:14px 12px;text-align:center;width:100%;font-size:11px;line-height:1.5;height:100%;}
.pfi{font-size:20px;margin-bottom:8px;}.pft{font-family:'Unbounded',sans-serif;font-size:10px;font-weight:600;letter-spacing:1px;text-transform:uppercase;margin-bottom:4px;}
.pfd{font-size:10.5px;color:var(--mu);font-weight:300;}
.pfa{display:flex;align-items:center;padding:0 4px;min-width:32px;color:var(--bd2);font-size:18px;flex-shrink:0;}
.ctbl{width:100%;border-collapse:collapse;font-size:12px;margin-bottom:16px;}
.ctbl th{padding:11px 14px;text-align:left;font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--mu);border-bottom:1px solid var(--bd2);}
.ctbl td{padding:10px 14px;border-bottom:1px solid var(--bd);color:var(--tx);vertical-align:top;line-height:1.5;}
.ctbl td:first-child{color:var(--mu);font-size:11px;font-weight:500;}
.ctbl tr:last-child td{border-bottom:none;}.ctbl tr:hover td{background:var(--s2);}
.d8{width:8px;height:8px;border-radius:50%;display:inline-block;}
code.ic{font-family:'DM Mono',monospace;font-size:11px;background:var(--s2);border:1px solid var(--bd);border-radius:3px;padding:1px 6px;color:#67e8f9;}
@keyframes riseUp{from{opacity:0;transform:translateY(24px);}to{opacity:1;transform:translateY(0);}}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
::-webkit-scrollbar{width:5px;height:5px;}::-webkit-scrollbar-track{background:var(--bg);}::-webkit-scrollbar-thumb{background:var(--bd2);border-radius:3px;}

/* â”€â”€ Light theme â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
[data-theme="light"]{--bg:#f5f7fa;--s1:#ffffff;--s2:#eef2f7;--bd:#dde3ee;--bd2:#c7d2e0;--tx:#0f172a;--mu:#64748b;--so:#94a3b8;--sa:#e11d48;--ad:#ea580c;--mg:#ca8a04;--ed:#16a34a;--vw:#0891b2;--gs:#7c3aed;--cr:#10b981;--rd:#3b82f6;--up:#d97706;--dl:#ef4444;}
[data-theme="light"] body{background:var(--bg);}
[data-theme="light"] body::before{background:repeating-linear-gradient(-55deg,transparent,transparent 60px,rgba(0,0,0,0.015) 60px,rgba(0,0,0,0.015) 61px);}
[data-theme="light"] .card{background:var(--s1);}
[data-theme="light"] .cb{background:var(--s2);}
[data-theme="light"] .note.ni{background:rgba(59,130,246,0.06);border-color:rgba(59,130,246,0.3);color:#1d4ed8;}
[data-theme="light"] .note.nw{background:rgba(217,119,6,0.06);border-color:rgba(217,119,6,0.3);color:#92400e;}
[data-theme="light"] .note.no{background:rgba(22,163,74,0.06);border-color:rgba(22,163,74,0.3);color:#14532d;}
[data-theme="light"] .note.ne{background:rgba(220,38,38,0.06);border-color:rgba(220,38,38,0.3);color:#991b1b;}
[data-theme="light"] pre{color:#475569;}
[data-theme="light"] code.ic{background:var(--s2);border-color:var(--bd);color:#0369a1;}
[data-theme="light"] .tabs{background:var(--bd);border-radius:8px;}
[data-theme="light"] .tab{background:var(--s2);color:var(--mu);}
[data-theme="light"] .tab.active{background:var(--s1);color:var(--tx);border-color:var(--bd2);}
[data-theme="light"] .tl::before{background:linear-gradient(to bottom,var(--rd),var(--gs),var(--vw));}
[data-theme="light"] .tli::before{background:var(--bg);}
[data-theme="light"] .ctbl th{border-color:var(--bd2);color:var(--mu);}
[data-theme="light"] .ctbl td{border-color:var(--bd);color:var(--tx);}
[data-theme="light"] .ctbl tr:hover td{background:var(--s2);}
[data-theme="light"] .sl{color:var(--mu);}
[data-theme="light"] .sl::after{background:var(--bd);}
[data-theme="light"] ::-webkit-scrollbar-track{background:#f1f5f9;}
[data-theme="light"] ::-webkit-scrollbar-thumb{background:#cbd5e1;}

/* â”€â”€ Toggle button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.theme-btn{position:fixed;top:18px;right:20px;z-index:9999;display:flex;align-items:center;gap:8px;padding:8px 16px;border-radius:20px;cursor:pointer;border:1px solid var(--bd);background:var(--s1);color:var(--tx);font-family:'DM Mono',monospace;font-size:11px;font-weight:600;letter-spacing:0.5px;box-shadow:0 2px 12px rgba(0,0,0,0.2);transition:all 0.2s;}
.theme-btn:hover{border-color:var(--rd);transform:translateY(-1px);box-shadow:0 4px 16px rgba(0,0,0,0.25);}
</style>
</head>
<body>
<style>
.backnav{position:sticky;top:0;z-index:200;display:flex;align-items:center;justify-content:space-between;padding:11px 28px;background:rgba(6,8,13,.88);backdrop-filter:blur(16px);border-bottom:1px solid var(--bd);gap:16px;}
[data-theme="light"] .backnav{background:rgba(245,247,250,.92);}
.backnav-left{display:flex;align-items:center;gap:12px;}
.backnav-home{display:flex;align-items:center;gap:8px;text-decoration:none;font-family:"DM Mono",monospace;font-size:11px;font-weight:500;letter-spacing:.5px;color:var(--mu);border:1px solid var(--bd);padding:6px 14px;border-radius:8px;transition:all .2s;}
.backnav-home:hover{color:var(--rd);border-color:var(--rd);}
.backnav-sep{color:var(--bd);font-size:14px;}
.backnav-title{font-family:"DM Mono",monospace;font-size:11px;color:var(--mu);letter-spacing:.5px;}
.backnav-pills{display:flex;gap:6px;flex-wrap:wrap;}
.backnav-pill{text-decoration:none;font-family:"DM Mono",monospace;font-size:10px;letter-spacing:.4px;padding:4px 10px;border-radius:5px;border:1px solid var(--bd);color:var(--mu);transition:all .15s;white-space:nowrap;}
.backnav-pill:hover{border-color:var(--rd);color:var(--rd);}
.backnav-pill.cur{border-color:var(--rd);color:var(--rd);background:rgba(96,165,250,.07);}
@media(max-width:700px){.backnav-pills{display:none;}}
</style>
<nav class="backnav">
  <div class="backnav-left">
    <a class="backnav-home" href="index.html">â† Index</a>
    <span class="backnav-sep">/</span>
    <span class="backnav-title">Role-Based Access Control</span>
  </div>
  <div class="backnav-pills">
    <a class="backnav-pill " href="auth-flow-diagram.html">Auth</a>
    <a class="backnav-pill " href="oauth-flow-diagram.html">OAuth</a>
    <a class="backnav-pill cur" href="rbac-diagram.html">RBAC</a>
    <a class="backnav-pill " href="scheduler-diagram.html">Scheduler</a>
    <a class="backnav-pill " href="rag-chat-diagram.html">RAG Chat</a>
  </div>
</nav>
<div class="wrap">
<div class="header">
  <div class="eyebrow">
    <span class="badge badge-r">RBAC</span>
    <span class="badge badge-m">Role-Based Access Control</span>
    <span class="badge badge-m">MERN Â· Production</span>
  </div>
  <h1>Who Can Do<br><em>What</em></h1>
  <p>Roles Â· Permissions Â· Ownership Â· Middleware chain Â· Frontend guards Â· MongoDB schema Â· Scaling</p>
</div>
<div class="tabs">
  <button class="tab active" onclick="go('concepts')">Concepts</button>
  <button class="tab" onclick="go('roles')">Roles & Hierarchy</button>
  <button class="tab" onclick="go('matrix')">Permission Matrix</button>
  <button class="tab" onclick="go('backend')">Backend Design</button>
  <button class="tab" onclick="go('middleware')">Middleware Chain</button>
  <button class="tab" onclick="go('frontend')">Frontend Guards</button>
  <button class="tab" onclick="go('advanced')">Advanced Patterns</button>
  <button class="tab" onclick="go('scale')">Scale</button>
</div>

<!-- CONCEPTS -->
<div class="panel active" id="tab-concepts">
<div class="sl">What is RBAC</div>
<div class="note ni"><strong>RBAC</strong> controls what each user can do by assigning them a <strong>role</strong>, and attaching <strong>permissions</strong> to roles not to individual users. Never check "is this userId allowed" â€” check "does this user's role have this permission."</div>
<div class="g3">
  <div class="card"><div class="ct"><span class="cd" style="background:var(--sa)"></span>The 3 Core Concepts</div>
    <div class="ir"><span class="ik">Role</span><span class="iv">Named group (admin, editor, viewer)</span></div>
    <div class="ir"><span class="ik">Permission</span><span class="iv">Action on a resource (posts:create)</span></div>
    <div class="ir"><span class="ik">Resource</span><span class="iv">The thing being acted on (Post, User)</span></div>
    <div class="ir"><span class="ik">Subject</span><span class="iv">The user performing the action</span></div>
    <div class="ir"><span class="ik">Formula</span><span class="iv">Subject â†’ Role â†’ Permissions â†’ Resource</span></div>
  </div>
  <div class="card"><div class="ct"><span class="cd" style="background:var(--ad)"></span>CRUD Actions</div>
    <div class="ir"><span class="ik" style="color:var(--cr)">create</span><span class="iv">POST â€” make new resource</span></div>
    <div class="ir"><span class="ik" style="color:var(--rd)">read</span><span class="iv">GET â€” view resource(s)</span></div>
    <div class="ir"><span class="ik" style="color:var(--up)">update</span><span class="iv">PUT/PATCH â€” modify resource</span></div>
    <div class="ir"><span class="ik" style="color:var(--dl)">delete</span><span class="iv">DELETE â€” remove resource</span></div>
    <div class="ir"><span class="ik">publish / approve</span><span class="iv">Custom domain actions</span></div>
  </div>
  <div class="card"><div class="ct"><span class="cd" style="background:var(--ed)"></span>Two Check Types</div>
    <div class="ir"><span class="ik">Role check</span><span class="iv">"Can any editor do this?" â€” static map</span></div>
    <div class="ir"><span class="ik">Ownership check</span><span class="iv">"Is this their own resource?" â€” DB lookup</span></div>
    <div class="ir"><span class="ik">:own suffix</span><span class="iv">posts:update:own = role + ownership</span></div>
    <div class="ir"><span class="ik">Admin bypass</span><span class="iv">admin/manager skip ownership check</span></div>
  </div>
</div>
<div class="sl">Permission String Convention</div>
<div class="cb">
  <div class="ch"><span class="d8" style="background:#c084fc"></span> Format: resource:action or resource:action:scope</div>
  <pre><span class="key">posts:create</span>          <span class="cm">// create any post</span>
<span class="key">posts:read</span>            <span class="cm">// read any post</span>
<span class="key">posts:update:own</span>      <span class="cm">// update only own posts â€” triggers ownership check</span>
<span class="key">posts:delete:own</span>      <span class="cm">// delete only own posts</span>
<span class="key">posts:publish</span>         <span class="cm">// custom action</span>
<span class="key">users:read</span>            <span class="cm">// list/view users</span>
<span class="key">users:role:update</span>     <span class="cm">// change a user's role</span>
<span class="key">posts:*</span>               <span class="cm">// resource wildcard â€” all actions on posts</span>
<span class="key">*:*</span>                   <span class="cm">// full wildcard â€” superadmin only</span></pre>
</div>
</div>

<!-- ROLES -->
<div class="panel" id="tab-roles">
<div class="sl">Role Hierarchy</div>
<div class="note nw"><strong>Design principle:</strong> Higher roles inherit all permissions of lower roles plus more. Superadmin contains Admin contains Manager contains Editor contains Viewer contains Guest.</div>
<div class="card" style="padding:28px;margin-bottom:16px;">
  <div class="hier">
    <div class="hrow">
      <div class="hrole" style="background:rgba(244,63,94,.08);border-color:rgba(244,63,94,.35);min-width:200px;">
        <div class="hrname" style="color:var(--sa)">Super Admin</div>
        <div class="hrdesc">Full system access Â· Manages admins</div>
      </div>
    </div>
    <div class="hconn"></div>
    <div class="hrow">
      <div class="hrole" style="background:rgba(249,115,22,.08);border-color:rgba(249,115,22,.35);min-width:200px;">
        <div class="hrname" style="color:var(--ad)">Admin</div>
        <div class="hrdesc">Manages users and all content</div>
      </div>
    </div>
    <div class="hconn"></div>
    <div class="hrow">
      <div class="hrole" style="background:rgba(234,179,8,.08);border-color:rgba(234,179,8,.35);min-width:200px;">
        <div class="hrname" style="color:var(--mg)">Manager</div>
        <div class="hrdesc">All content Â· No user management</div>
      </div>
    </div>
    <div class="hconn"></div>
    <div class="hrow" style="gap:16px;">
      <div class="hrole" style="background:rgba(34,197,94,.08);border-color:rgba(34,197,94,.35);min-width:130px;">
        <div class="hrname" style="color:var(--ed)">Editor</div>
        <div class="hrdesc">Own content CRUD</div>
      </div>
      <div class="hrole" style="background:rgba(6,182,212,.08);border-color:rgba(6,182,212,.35);min-width:130px;">
        <div class="hrname" style="color:var(--vw)">Viewer</div>
        <div class="hrdesc">Read-only access</div>
      </div>
      <div class="hrole" style="background:rgba(139,92,246,.08);border-color:rgba(139,92,246,.35);min-width:130px;">
        <div class="hrname" style="color:var(--gs)">Guest</div>
        <div class="hrdesc">Public content only</div>
      </div>
    </div>
  </div>
</div>
<div class="sl">Role Definitions</div>
<div class="g2">
  <div class="card"><div class="ct"><span class="cd" style="background:var(--sa)"></span>Super Admin</div>
    <div class="ir"><span class="ik">Permissions</span><span class="iv">*:* â€” full wildcard</span></div>
    <div class="ir"><span class="ik">Count</span><span class="iv"><span class="pill pr">1â€“2 max â€” hardcoded in env</span></span></div>
    <div class="ir"><span class="ik">Can</span><span class="iv">Delete any user, change any role, system config</span></div>
    <div class="ir"><span class="ik">Set via</span><span class="iv">Direct DB or bootstrap script only</span></div>
  </div>
  <div class="card"><div class="ct"><span class="cd" style="background:var(--ad)"></span>Admin</div>
    <div class="ir"><span class="ik">Permissions</span><span class="iv">users:*, content:*, audit:read</span></div>
    <div class="ir"><span class="ik">Can</span><span class="iv">Ban users, promote to editor/manager</span></div>
    <div class="ir"><span class="ik">Cannot</span><span class="iv">Promote to admin or superadmin</span></div>
  </div>
  <div class="card"><div class="ct"><span class="cd" style="background:var(--mg)"></span>Manager</div>
    <div class="ir"><span class="ik">Permissions</span><span class="iv">posts:*, comments:*, media:*</span></div>
    <div class="ir"><span class="ik">Can</span><span class="iv">Edit/delete anyone's content, approve</span></div>
    <div class="ir"><span class="ik">Cannot</span><span class="iv">Manage users or roles</span></div>
  </div>
  <div class="card"><div class="ct"><span class="cd" style="background:var(--ed)"></span>Editor</div>
    <div class="ir"><span class="ik">Permissions</span><span class="iv">posts:create, posts:update:own, posts:delete:own</span></div>
    <div class="ir"><span class="ik">Can</span><span class="iv">Full CRUD on own items, publish own</span></div>
    <div class="ir"><span class="ik">Cannot</span><span class="iv">Touch others' content</span></div>
  </div>
  <div class="card"><div class="ct"><span class="cd" style="background:var(--vw)"></span>Viewer</div>
    <div class="ir"><span class="ik">Permissions</span><span class="iv">posts:read, comments:read, comments:create</span></div>
    <div class="ir"><span class="ik">Can</span><span class="iv">View all published content, post comments</span></div>
    <div class="ir"><span class="ik">Cannot</span><span class="iv">Create or delete content</span></div>
  </div>
  <div class="card"><div class="ct"><span class="cd" style="background:var(--gs)"></span>Guest</div>
    <div class="ir"><span class="ik">Permissions</span><span class="iv">posts:read (public only)</span></div>
    <div class="ir"><span class="ik">Who</span><span class="iv">Unauthenticated users</span></div>
    <div class="ir"><span class="ik">Cannot</span><span class="iv">Access any auth-protected route</span></div>
  </div>
</div>
</div>

<!-- MATRIX -->
<div class="panel" id="tab-matrix">
<div class="sl">Permission Matrix</div>
<div class="note ni"><strong>Legend:</strong> <span style="color:var(--cr);margin-left:12px">checkmark = allowed</span> <span style="color:#fbbf24;margin-left:12px">circle = own only</span> <span style="color:var(--bd2);margin-left:12px;opacity:.6">dash = denied</span></div>
<div class="mwrap">
  <table class="mx">
    <thead>
      <tr>
        <th>Resource Â· Action</th>
        <th style="color:var(--sa)">Super Admin</th>
        <th style="color:var(--ad)">Admin</th>
        <th style="color:var(--mg)">Manager</th>
        <th style="color:var(--ed)">Editor</th>
        <th style="color:var(--vw)">Viewer</th>
        <th style="color:var(--gs)">Guest</th>
      </tr>
    </thead>
    <tbody>
      <tr><td class="rg" colspan="7">USERS</td></tr>
      <tr><td>users Â· list all</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="dc">â€”</td><td class="dc">â€”</td><td class="dc">â€”</td><td class="dc">â€”</td></tr>
      <tr><td>users Â· view profile</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="oc">â—</td><td class="oc">â—</td><td class="dc">â€”</td></tr>
      <tr><td>users Â· update profile</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="dc">â€”</td><td class="oc">â—</td><td class="oc">â—</td><td class="dc">â€”</td></tr>
      <tr><td>users Â· change role</td><td class="ac">âœ“</td><td class="ac" style="font-size:11px">âœ“ (editorâ†“)</td><td class="dc">â€”</td><td class="dc">â€”</td><td class="dc">â€”</td><td class="dc">â€”</td></tr>
      <tr><td>users Â· delete</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="dc">â€”</td><td class="dc">â€”</td><td class="dc">â€”</td><td class="dc">â€”</td></tr>
      <tr><td>users Â· ban / suspend</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="dc">â€”</td><td class="dc">â€”</td><td class="dc">â€”</td><td class="dc">â€”</td></tr>
      <tr><td class="rg" colspan="7">POSTS / CONTENT</td></tr>
      <tr><td>posts Â· create</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="dc">â€”</td><td class="dc">â€”</td></tr>
      <tr><td>posts Â· read (published)</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="ac">âœ“</td></tr>
      <tr><td>posts Â· read (draft)</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="oc">â—</td><td class="dc">â€”</td><td class="dc">â€”</td></tr>
      <tr><td>posts Â· update</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="oc">â—</td><td class="dc">â€”</td><td class="dc">â€”</td></tr>
      <tr><td>posts Â· delete</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="oc">â—</td><td class="dc">â€”</td><td class="dc">â€”</td></tr>
      <tr><td>posts Â· publish / approve</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="oc">â—</td><td class="dc">â€”</td><td class="dc">â€”</td></tr>
      <tr><td class="rg" colspan="7">COMMENTS</td></tr>
      <tr><td>comments Â· create</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="dc">â€”</td></tr>
      <tr><td>comments Â· delete</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="oc">â—</td><td class="oc">â—</td><td class="dc">â€”</td></tr>
      <tr><td>comments Â· moderate all</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="dc">â€”</td><td class="dc">â€”</td><td class="dc">â€”</td></tr>
      <tr><td class="rg" colspan="7">SYSTEM / SETTINGS</td></tr>
      <tr><td>settings Â· view</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="dc">â€”</td><td class="dc">â€”</td><td class="dc">â€”</td><td class="dc">â€”</td></tr>
      <tr><td>settings Â· update</td><td class="ac">âœ“</td><td class="dc">â€”</td><td class="dc">â€”</td><td class="dc">â€”</td><td class="dc">â€”</td><td class="dc">â€”</td></tr>
      <tr><td>audit logs Â· view</td><td class="ac">âœ“</td><td class="ac">âœ“</td><td class="dc">â€”</td><td class="dc">â€”</td><td class="dc">â€”</td><td class="dc">â€”</td></tr>
    </tbody>
  </table>
</div>
</div>

<!-- BACKEND -->
<div class="panel" id="tab-backend">
<div class="sl">MongoDB Schema + Permissions Config</div>
<div class="g2">
  <div class="cb">
    <div class="ch"><span class="d8" style="background:var(--up)"></span> User document</div>
    <pre>{
  email:        <span class="obj">String</span>,
  passwordHash: <span class="obj">String</span>,
  <span class="key">role</span>: {
    type:    <span class="obj">String</span>,
    enum:    [<span class="str">'superadmin'</span>,<span class="str">'admin'</span>,
              <span class="str">'manager'</span>,<span class="str">'editor'</span>,
              <span class="str">'viewer'</span>,<span class="str">'guest'</span>],
    default: <span class="str">'viewer'</span>,
    index:   <span class="kw">true</span>
  },
  <span class="key">roleVersion</span>: { type: <span class="obj">Number</span>, default: <span class="num">0</span> },
  isBanned:     <span class="obj">Boolean</span>,
}</pre>
  </div>
  <div class="cb">
    <div class="ch"><span class="d8" style="background:var(--cr)"></span> Resource â€” ownership</div>
    <pre>{
  title:   <span class="obj">String</span>,
  content: <span class="obj">String</span>,
  status:  <span class="str">'draft'|'published'</span>,
  <span class="key">createdBy</span>: {
    type:  ObjectId,
    ref:   <span class="str">'User'</span>,
    index: <span class="kw">true</span>
  },
  updatedBy: ObjectId,
  publishedAt: <span class="obj">Date</span>,
  createdAt, updatedAt
}</pre>
  </div>
</div>
<div class="note no"><strong>Store permissions as a static JS object</strong> in your codebase â€” not in MongoDB. Role definitions rarely change and this keeps permission checks O(1) with zero DB lookups.</div>
<div class="cb">
  <div class="ch"><span class="d8" style="background:#c084fc"></span> config/permissions.js â€” single source of truth</div>
  <pre><span class="kw">const</span> PERMISSIONS = {
  superadmin: [<span class="str">'*:*'</span>],

  admin: [
    <span class="str">'users:read'</span>,<span class="str">'users:update'</span>,<span class="str">'users:delete'</span>,<span class="str">'users:role:update'</span>,
    <span class="str">'posts:*'</span>,<span class="str">'comments:*'</span>,<span class="str">'media:*'</span>,<span class="str">'settings:read'</span>,<span class="str">'audit:read'</span>
  ],

  manager: [<span class="str">'posts:*'</span>,<span class="str">'comments:*'</span>,<span class="str">'media:*'</span>],

  editor: [
    <span class="str">'posts:create'</span>,<span class="str">'posts:read'</span>,<span class="str">'posts:update:own'</span>,
    <span class="str">'posts:delete:own'</span>,<span class="str">'posts:publish:own'</span>,
    <span class="str">'comments:create'</span>,<span class="str">'comments:read'</span>,<span class="str">'comments:delete:own'</span>
  ],

  viewer: [<span class="str">'posts:read'</span>,<span class="str">'comments:read'</span>,<span class="str">'comments:create'</span>],
  guest:  [<span class="str">'posts:read'</span>]
};

<span class="kw">function</span> <span class="fn">hasPermission</span>(role, permission) {
  <span class="kw">const</span> perms = PERMISSIONS[role] || [];
  <span class="kw">return</span> perms.includes(<span class="str">'*:*'</span>) ||
         perms.includes(permission) ||
         perms.includes(permission.<span class="fn">split</span>(<span class="str">':'</span>)[<span class="num">0</span>] + <span class="str">':*'</span>);
}

module.exports = { PERMISSIONS, <span class="fn">hasPermission</span> };</pre>
</div>
<div class="cb">
  <div class="ch"><span class="d8" style="background:var(--rd)"></span> Include role in JWT â€” no DB hit per request</div>
  <pre><span class="kw">const</span> payload = {
  <span class="key">userId</span>:      user._id,
  <span class="key">role</span>:        user.role,          <span class="cm">// role in token â€” no DB lookup needed</span>
  <span class="key">roleVersion</span>: user.roleVersion,    <span class="cm">// for instant invalidation on role change</span>
  <span class="key">email</span>:       user.email
};
jwt.<span class="fn">sign</span>(payload, process.env.JWT_SECRET, { expiresIn: <span class="str">'15m'</span> });</pre>
</div>
</div>

<!-- MIDDLEWARE -->
<div class="panel" id="tab-middleware">
<div class="sl">The Full Request Chain</div>
<div class="card" style="padding:24px;margin-bottom:16px;overflow-x:auto;">
  <div class="pflow" style="min-width:700px;">
    <div class="pfs"><div class="pfb"><div class="pfi">ğŸ“¨</div><div class="pft">Request</div><div class="pfd">HTTP arrives at Express route</div></div></div>
    <div class="pfa">â†’</div>
    <div class="pfs"><div class="pfb" style="border-color:rgba(96,165,250,.4)"><div class="pfi" style="font-size:16px">ğŸ”‘</div><div class="pft" style="color:#60a5fa">authenticate()</div><div class="pfd">Verify JWT. Set req.user. 401 if invalid.</div></div></div>
    <div class="pfa">â†’</div>
    <div class="pfs"><div class="pfb" style="border-color:rgba(167,139,250,.4)"><div class="pfi" style="font-size:16px">ğŸ›¡</div><div class="pft" style="color:#a78bfa">authorize()</div><div class="pfd">Check role has permission. 403 if not.</div></div></div>
    <div class="pfa">â†’</div>
    <div class="pfs"><div class="pfb" style="border-color:rgba(251,191,36,.4)"><div class="pfi" style="font-size:16px">ğŸ‘¤</div><div class="pft" style="color:#fbbf24">checkOwnership()</div><div class="pfd">If :own permission, verify resource belongs to user.</div></div></div>
    <div class="pfa">â†’</div>
    <div class="pfs"><div class="pfb" style="border-color:rgba(52,211,153,.4)"><div class="pfi" style="font-size:16px">âœ…</div><div class="pft" style="color:#34d399">Controller</div><div class="pfd">Business logic runs safely.</div></div></div>
  </div>
</div>
<div class="sl">Middleware Code</div>
<div class="cb">
  <div class="ch"><span class="d8" style="background:#60a5fa"></span> authenticate.js</div>
  <pre><span class="kw">const</span> <span class="fn">authenticate</span> = (req, res, next) => {
  <span class="kw">const</span> header = req.headers.authorization;
  <span class="kw">if</span> (!header?.startsWith(<span class="str">'Bearer '</span>))
    <span class="kw">return</span> res.<span class="fn">status</span>(<span class="num">401</span>).<span class="fn">json</span>({ error: <span class="str">'UNAUTHORIZED'</span> });
  <span class="kw">try</span> {
    <span class="kw">const</span> payload = jwt.<span class="fn">verify</span>(header.split(<span class="str">' '</span>)[<span class="num">1</span>], process.env.JWT_SECRET);
    req.user = payload;   <span class="cm">// { userId, role, roleVersion, email }</span>
    <span class="fn">next</span>();
  } <span class="kw">catch</span>(e) {
    <span class="kw">const</span> code = e.name === <span class="str">'TokenExpiredError'</span> ? <span class="str">'TOKEN_EXPIRED'</span> : <span class="str">'INVALID_TOKEN'</span>;
    res.<span class="fn">status</span>(<span class="num">401</span>).<span class="fn">json</span>({ error: code });
  }
};</pre>
</div>
<div class="cb">
  <div class="ch"><span class="d8" style="background:#a78bfa"></span> authorize.js + route examples</div>
  <pre><span class="cm">// Factory: returns middleware for required permission</span>
<span class="kw">const</span> <span class="fn">authorize</span> = (permission) => (req, res, next) => {
  <span class="kw">if</span> (!<span class="fn">hasPermission</span>(req.user.role, permission))
    <span class="kw">return</span> res.<span class="fn">status</span>(<span class="num">403</span>).<span class="fn">json</span>({ error: <span class="str">'FORBIDDEN'</span> });
  req.requiresOwnership = permission.includes(<span class="str">':own'</span>);
  <span class="fn">next</span>();
};

<span class="cm">// Route examples:</span>
router.<span class="fn">get</span>(<span class="str">'/posts'</span>,              controller.<span class="fn">listPublished</span>);                           <span class="cm">// public</span>
router.<span class="fn">post</span>(<span class="str">'/posts'</span>,             authenticate, <span class="fn">authorize</span>(<span class="str">'posts:create'</span>),        controller.<span class="fn">create</span>);
router.<span class="fn">put</span>(<span class="str">'/posts/:id'</span>,          authenticate, <span class="fn">authorize</span>(<span class="str">'posts:update:own'</span>),   <span class="fn">checkOwnership</span>(Post), controller.<span class="fn">update</span>);
router.<span class="fn">delete</span>(<span class="str">'/posts/:id'</span>,       authenticate, <span class="fn">authorize</span>(<span class="str">'posts:delete:own'</span>),   <span class="fn">checkOwnership</span>(Post), controller.<span class="fn">delete</span>);
router.<span class="fn">get</span>(<span class="str">'/admin/users'</span>,        authenticate, <span class="fn">authorize</span>(<span class="str">'users:read'</span>),         controller.<span class="fn">listUsers</span>);
router.<span class="fn">patch</span>(<span class="str">'/users/:id/role'</span>,   authenticate, <span class="fn">authorize</span>(<span class="str">'users:role:update'</span>),  controller.<span class="fn">updateRole</span>);</pre>
</div>
<div class="cb">
  <div class="ch"><span class="d8" style="background:#fbbf24"></span> checkOwnership.js</div>
  <pre><span class="kw">const</span> <span class="fn">checkOwnership</span> = (Model) => <span class="kw">async</span> (req, res, next) => {
  <span class="cm">// Admins and managers bypass ownership â€” they can edit anything</span>
  <span class="kw">if</span> ([<span class="str">'superadmin'</span>,<span class="str">'admin'</span>,<span class="str">'manager'</span>].includes(req.user.role) || !req.requiresOwnership)
    <span class="kw">return</span> <span class="fn">next</span>();

  <span class="kw">const</span> resource = <span class="kw">await</span> Model.<span class="fn">findById</span>(req.params.id).<span class="fn">lean</span>();
  <span class="kw">if</span> (!resource) <span class="kw">return</span> res.<span class="fn">status</span>(<span class="num">404</span>).<span class="fn">json</span>({ error: <span class="str">'NOT_FOUND'</span> });

  <span class="kw">if</span> (!resource.createdBy.<span class="fn">equals</span>(req.user.userId))
    <span class="kw">return</span> res.<span class="fn">status</span>(<span class="num">403</span>).<span class="fn">json</span>({ error: <span class="str">'FORBIDDEN'</span>, message: <span class="str">'Not your resource'</span> });

  req.resource = resource;  <span class="cm">// attach â€” avoids 2nd DB hit in controller</span>
  <span class="fn">next</span>();
};</pre>
</div>
</div>

<!-- FRONTEND -->
<div class="panel" id="tab-frontend">
<div class="note ne"><strong>Critical:</strong> Frontend guards are UX only â€” they hide buttons and redirect users. They are NOT security. All real authorization happens on the backend. Never skip backend checks because the frontend hides something.</div>
<div class="sl">3 Levels of Frontend Protection</div>
<div class="g3">
  <div class="card"><div class="ct"><span class="cd" style="background:var(--rd)"></span>Route Guard</div>
    <div style="font-size:11.5px;color:var(--mu);line-height:1.7;">Protect entire pages. Redirect unauthorized users to /login or /403. Applied via ProtectedRoute wrapping React Router routes.</div>
    <div style="margin-top:10px"><span class="pill pb">React Router</span></div>
  </div>
  <div class="card"><div class="ct"><span class="cd" style="background:var(--up)"></span>Component Guard</div>
    <div style="font-size:11.5px;color:var(--mu);line-height:1.7;">Show or hide UI elements (buttons, menus, forms) based on role. Wrap with a Can component or usePermission hook.</div>
    <div style="margin-top:10px"><span class="pill pa">JSX Conditional</span></div>
  </div>
  <div class="card"><div class="ct"><span class="cd" style="background:var(--cr)"></span>API Error Guard</div>
    <div style="font-size:11.5px;color:var(--mu);line-height:1.7;">Handle 401/403 from API. Refresh on 401. Show error UI on 403. Axios interceptors handle this automatically.</div>
    <div style="margin-top:10px"><span class="pill pg">Axios Interceptor</span></div>
  </div>
</div>
<div class="cb">
  <div class="ch"><span class="d8" style="background:#c084fc"></span> hooks/usePermission.js</div>
  <pre><span class="kw">import</span> { PERMISSIONS } <span class="kw">from</span> <span class="str">'../config/permissions'</span>;  <span class="cm">// shared FE + BE config</span>
<span class="kw">import</span> { useAuthStore } <span class="kw">from</span> <span class="str">'../store/authStore'</span>;

<span class="kw">const</span> HIERARCHY = [<span class="str">'guest'</span>,<span class="str">'viewer'</span>,<span class="str">'editor'</span>,<span class="str">'manager'</span>,<span class="str">'admin'</span>,<span class="str">'superadmin'</span>];

<span class="kw">export function</span> <span class="fn">usePermission</span>() {
  <span class="kw">const</span> { user } = <span class="fn">useAuthStore</span>();

  <span class="kw">const</span> <span class="fn">can</span> = (permission) => {
    <span class="kw">if</span> (!user) <span class="kw">return false</span>;
    <span class="kw">if</span> (user.role === <span class="str">'superadmin'</span>) <span class="kw">return true</span>;
    <span class="kw">return</span> PERMISSIONS[user.role]?.includes(permission) ?? <span class="kw">false</span>;
  };

  <span class="kw">const</span> <span class="fn">hasRole</span> = (minRole) =>
    user ? HIERARCHY.<span class="fn">indexOf</span>(user.role) >= HIERARCHY.<span class="fn">indexOf</span>(minRole) : <span class="kw">false</span>;

  <span class="kw">const</span> <span class="fn">isOwner</span> = (id) => user?._id === id;

  <span class="kw">return</span> { <span class="fn">can</span>, <span class="fn">hasRole</span>, <span class="fn">isOwner</span> };
}</pre>
</div>
<div class="cb">
  <div class="ch"><span class="d8" style="background:var(--cr)"></span> ProtectedRoute.jsx + Can.jsx</div>
  <pre><span class="cm">// Route Guard</span>
<span class="kw">export function</span> <span class="fn">ProtectedRoute</span>({ children, minRole = <span class="str">'viewer'</span>, permission }) {
  <span class="kw">const</span> { user, isAuthLoading } = <span class="fn">useAuthStore</span>();
  <span class="kw">const</span> { can, hasRole } = <span class="fn">usePermission</span>();
  <span class="kw">const</span> location = <span class="fn">useLocation</span>();
  <span class="kw">if</span> (isAuthLoading) <span class="kw">return</span> &lt;Spinner /&gt;;
  <span class="kw">if</span> (!user) <span class="kw">return</span> &lt;Navigate to=<span class="str">"/login"</span> state={{ from: location }} replace /&gt;;
  <span class="kw">if</span> (permission && !<span class="fn">can</span>(permission)) <span class="kw">return</span> &lt;Forbidden /&gt;;
  <span class="kw">if</span> (!<span class="fn">hasRole</span>(minRole)) <span class="kw">return</span> &lt;Forbidden /&gt;;
  <span class="kw">return</span> children;
}

<span class="cm">// Component Guard</span>
<span class="kw">export function</span> <span class="fn">Can</span>({ permission, minRole, ownerId, children, fallback = null }) {
  <span class="kw">const</span> { can, hasRole, isOwner } = <span class="fn">usePermission</span>();
  <span class="kw">const</span> ok =
    (permission ? <span class="fn">can</span>(permission)   : <span class="kw">true</span>) &&
    (minRole    ? <span class="fn">hasRole</span>(minRole) : <span class="kw">true</span>) &&
    (ownerId    ? (<span class="fn">isOwner</span>(ownerId) || <span class="fn">hasRole</span>(<span class="str">'manager'</span>)) : <span class="kw">true</span>);
  <span class="kw">return</span> ok ? children : fallback;
}

<span class="cm">// Usage:</span>
&lt;Route path=<span class="str">"/admin"</span> element={&lt;ProtectedRoute minRole=<span class="str">"admin"</span>&gt;&lt;AdminPanel /&gt;&lt;/ProtectedRoute&gt;} /&gt;

&lt;Can permission=<span class="str">"posts:delete:own"</span> ownerId={post.createdBy}&gt;
  &lt;DeleteButton /&gt;
&lt;/Can&gt;</pre>
</div>
</div>

<!-- ADVANCED -->
<div class="panel" id="tab-advanced">
<div class="sl">Advanced RBAC Patterns</div>
<div class="tl">
  <div class="tli si">
    <div class="tlt">Pattern 1 Â· Role Change Invalidation <span class="pill pa">Important</span></div>
    <div class="tld">When an admin changes a user's role, the current JWT retains the old role until 15-min expiry. Add a <code class="ic">roleVersion</code> field to the user, included in the JWT. On every protected request, compare token's roleVersion with DB. Mismatch forces token refresh.</div>
  </div>
  <div class="tli sw">
    <div class="tlt">Pattern 2 Â· Per-User Permission Overrides <span class="pill pp">Advanced</span></div>
    <div class="tld">Temporarily elevate one user's access to a specific resource. Store in a PermissionOverride collection: { userId, resourceType, resourceId, permissions[], expiresAt }. Check this after a role-level deny â€” before returning 403.</div>
  </div>
  <div class="tli so">
    <div class="tlt">Pattern 3 Â· Multi-Tenancy (Org Roles) <span class="pill pb">SaaS Pattern</span></div>
    <div class="tld">User can be admin in Org A and viewer in Org B. Store roles on the membership record, not the user document. Schema: OrgMembership { userId, orgId, role }. JWT includes current orgId. Middleware checks role for that specific org.</div>
  </div>
  <div class="tli so">
    <div class="tlt">Pattern 4 Â· Audit Logging <span class="pill pg">Production Must</span></div>
    <div class="tld">Log every sensitive action: userId, role, action (permission string), resourceType, resourceId, outcome (allow/deny), ip, userAgent, timestamp. Separate AuditLog collection with TTL index. Essential for compliance and debugging.</div>
  </div>
  <div class="tli se">
    <div class="tlt">Pattern 5 Â· Superadmin Protection <span class="pill pr">Never Skip</span></div>
    <div class="tld">No one can change superadmin's role via API â€” not even other admins. Hardcode superadmin emails in env. In role-update controller, reject if target is superadmin. Superadmin set only via direct DB access or bootstrap script.</div>
  </div>
</div>
<div class="sl">Role Escalation Prevention</div>
<div class="cb">
  <div class="ch"><span class="d8" style="background:var(--sa)"></span> updateUserRole controller</div>
  <pre><span class="kw">const</span> <span class="fn">updateUserRole</span> = <span class="kw">async</span> (req, res) => {
  <span class="kw">const</span> { userId } = req.params;
  <span class="kw">const</span> { newRole } = req.body;
  <span class="kw">const</span> requester = req.user;

  <span class="cm">// 1. Cannot change own role</span>
  <span class="kw">if</span> (requester.userId === userId)
    <span class="kw">return</span> res.<span class="fn">status</span>(<span class="num">403</span>).<span class="fn">json</span>({ error: <span class="str">'Cannot change own role'</span> });

  <span class="cm">// 2. Cannot promote to role >= own</span>
  <span class="kw">const</span> hierarchy = [<span class="str">'guest'</span>,<span class="str">'viewer'</span>,<span class="str">'editor'</span>,<span class="str">'manager'</span>,<span class="str">'admin'</span>,<span class="str">'superadmin'</span>];
  <span class="kw">if</span> (hierarchy.<span class="fn">indexOf</span>(newRole) >= hierarchy.<span class="fn">indexOf</span>(requester.role))
    <span class="kw">return</span> res.<span class="fn">status</span>(<span class="num">403</span>).<span class="fn">json</span>({ error: <span class="str">'Cannot promote to role >= own'</span> });

  <span class="cm">// 3. Cannot demote a superadmin</span>
  <span class="kw">const</span> target = <span class="kw">await</span> User.<span class="fn">findById</span>(userId);
  <span class="kw">if</span> (target.role === <span class="str">'superadmin'</span>)
    <span class="kw">return</span> res.<span class="fn">status</span>(<span class="num">403</span>).<span class="fn">json</span>({ error: <span class="str">'Cannot modify superadmin'</span> });

  <span class="cm">// 4. Increment roleVersion to invalidate old JWT</span>
  target.role = newRole;
  target.roleVersion = (target.roleVersion || <span class="num">0</span>) + <span class="num">1</span>;
  <span class="kw">await</span> target.<span class="fn">save</span>();
  res.<span class="fn">json</span>({ success: <span class="kw">true</span> });
};</pre>
</div>
<div class="sl">RBAC vs ABAC</div>
<div class="card">
  <table class="ctbl">
    <thead><tr><th>Situation</th><th>Use RBAC</th><th>Consider ABAC</th></tr></thead>
    <tbody>
      <tr><td>Access rules</td><td>Based on role alone</td><td>Time, location, resource attributes</td></tr>
      <tr><td>Complexity</td><td>Simple hierarchy</td><td>100+ roles or highly dynamic rules</td></tr>
      <tr><td>Ownership</td><td>Simple own/any split</td><td>Complex sharing trees (Google Drive)</td></tr>
      <tr><td>Team size</td><td>Startups to mid-size</td><td>Enterprise with compliance needs</td></tr>
      <tr><td>Libraries</td><td>Custom code + casl.js</td><td>casbin, Open Policy Agent (OPA)</td></tr>
      <tr><td>Verdict</td><td><span class="pill pg">Start here â€” covers 95% of apps</span></td><td>Only when RBAC becomes unmanageable</td></tr>
    </tbody>
  </table>
</div>
</div>

<!-- SCALE -->
<div class="panel" id="tab-scale">
<div class="sl">Scaling RBAC</div>
<div class="note no"><strong>Good news:</strong> Role checks are extremely fast â€” just string comparisons against a static JS object. Zero DB calls per request for permission checks. The main scaling concerns are token invalidation and caching ownership lookups.</div>
<div class="g2">
  <div class="card"><div class="ct"><span class="cd" style="background:var(--cr)"></span>Few Users</div>
    <div class="ir"><span class="ik">Permission check</span><span class="iv">Static JS object â€” O(1), no DB</span></div>
    <div class="ir"><span class="ik">Role in JWT</span><span class="iv">No DB lookup per request</span></div>
    <div class="ir"><span class="ik">Ownership check</span><span class="iv">Single MongoDB findById</span></div>
    <div class="ir"><span class="ik">Role updates</span><span class="iv">Old JWT expires in 15 min â€” acceptable</span></div>
    <div class="ir"><span class="ik">Audit log</span><span class="iv">MongoDB TTL collection</span></div>
    <div class="ir"><span class="ik">RBAC config</span><span class="iv">Static JS file, deployed with code</span></div>
  </div>
  <div class="card"><div class="ct"><span class="cd" style="background:var(--ad)"></span>Millions of Users</div>
    <div class="ir"><span class="ik">Permission check</span><span class="iv">Same â€” static JS, no overhead</span></div>
    <div class="ir"><span class="ik">Role invalidation</span><span class="iv">roleVersion in JWT + DB check on sensitive ops</span></div>
    <div class="ir"><span class="ik">Ownership check</span><span class="iv">Redis cache for hot resources (TTL 5 min)</span></div>
    <div class="ir"><span class="ik">Role updates</span><span class="iv">Publish event â†’ invalidate user cache in Redis</span></div>
    <div class="ir"><span class="ik">Audit log</span><span class="iv">Stream to Datadog / ELK stack</span></div>
    <div class="ir"><span class="ik">RBAC config</span><span class="iv">DB-backed + Redis cached for dynamic roles</span></div>
  </div>
</div>
<div class="sl">Package Summary</div>
<div class="g3">
  <div class="card"><div class="ct"><span class="cd" style="background:#a78bfa"></span>Backend</div>
    <div class="ir"><span class="ik">Custom RBAC</span><span class="iv">permissions.js â€” recommended</span></div>
    <div class="ir"><span class="ik">OR library</span><span class="iv">casl (feature-rich ABAC/RBAC)</span></div>
    <div class="ir"><span class="ik">JWT</span><span class="iv">jsonwebtoken</span></div>
    <div class="ir"><span class="ik">Validation</span><span class="iv">zod â€” validate role in req body</span></div>
    <div class="ir"><span class="ik">Audit log</span><span class="iv">Custom MongoDB collection</span></div>
    <div class="ir"><span class="ik">Cache (scale)</span><span class="iv">ioredis</span></div>
  </div>
  <div class="card"><div class="ct"><span class="cd" style="background:var(--cr)"></span>Frontend</div>
    <div class="ir"><span class="ik">Permission hook</span><span class="iv">Custom usePermission()</span></div>
    <div class="ir"><span class="ik">Route guard</span><span class="iv">ProtectedRoute component</span></div>
    <div class="ir"><span class="ik">UI guard</span><span class="iv">Can component</span></div>
    <div class="ir"><span class="ik">State</span><span class="iv">Zustand â€” role in user object</span></div>
    <div class="ir"><span class="ik">403 handling</span><span class="iv">Axios response interceptor</span></div>
  </div>
  <div class="card"><div class="ct"><span class="cd" style="background:var(--vw)"></span>Key Principles</div>
    <div class="ir"><span class="ik">Never trust FE</span><span class="iv"><span class="pill pr">Always enforce on backend</span></span></div>
    <div class="ir"><span class="ik">Role in JWT</span><span class="iv"><span class="pill pg">No DB call per request</span></span></div>
    <div class="ir"><span class="ik">Static config</span><span class="iv"><span class="pill pg">PERMISSIONS map in code</span></span></div>
    <div class="ir"><span class="ik">Ownership</span><span class="iv">createdBy field + middleware</span></div>
    <div class="ir"><span class="ik">Escalation</span><span class="iv">Cannot promote to >= own role</span></div>
    <div class="ir"><span class="ik">Superadmin</span><span class="iv">Protect in env, never via API</span></div>
  </div>
</div>
</div>

</div>
<button class="theme-btn" onclick="toggleTheme()" id="themeBtn">
  <span class="icon">ğŸŒ™</span><span id="themeLabel">Light Mode</span>
</button>
<script>
function go(n){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById('tab-'+n).classList.add('active');
}
function toggleTheme(){
  const html=document.documentElement;
  const isLight=html.getAttribute('data-theme')==='light';
  html.setAttribute('data-theme',isLight?'dark':'light');
  document.getElementById('themeLabel').textContent=isLight?'Light Mode':'Dark Mode';
  document.querySelector('#themeBtn .icon').textContent=isLight?'ğŸŒ™':'â˜€ï¸';
  localStorage.setItem('theme',isLight?'dark':'light');
}
(function(){
  const saved=localStorage.getItem('theme')||'dark';
  document.documentElement.setAttribute('data-theme',saved);
  if(saved==='light'){
    document.addEventListener('DOMContentLoaded',()=>{
      document.getElementById('themeLabel').textContent='Dark Mode';
      document.querySelector('#themeBtn .icon').textContent='â˜€ï¸';
    });
  }
})();
</script>
</body>
</html>
